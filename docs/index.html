<!DOCTYPE html><html class="default no-js"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@mgdigital/tsinject - v0.1.10</title><meta name="description" content="Documentation for @mgdigital/tsinject - v0.1.10"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem(&quot;tsd-theme&quot;) || &quot;os&quot;)</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@mgdigital/tsinject - v0.1.10</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@mgdigital/tsinject - v0.1.10</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#tsinject" id="tsinject" style="color: inherit; text-decoration: none;">
  <h1>tsinject</h1>
</a>
<p>Lightweight and flexible dependency injection container for Typescript</p>

<a href="#motivation" id="motivation" style="color: inherit; text-decoration: none;">
  <h2>Motivation</h2>
</a>
<p>Several dependency injection solutions exist for TypeScript. Most use either decorators (Inversify; TSyringe) or static class properties (Angular). This has several drawbacks:</p>
<ul>
<li>The types of service that can be defined are restricted to class instances.</li>
<li>The code of the class needs modifying to work with the container (e.g. by adding decorators or static properties).</li>
<li>It will only work with the <code>expermentalDecorators</code> option enabled.</li>
</ul>
<p>tsinject adopts an alternative approach with several objectives:</p>

<a href="#flexibility" id="flexibility" style="color: inherit; text-decoration: none;">
  <h3>Flexibility</h3>
</a>
<p>tsinject works by defining named factory functions in a container builder, with unique symbols mapping services available in the container to their type. These factory functions can return anything, allowing configuration objects, class instances, functions or any other type of value to be defined as a container service. Any code can be containerized without need for modifications such as annotations or static properties.</p>

<a href="#avoiding-global-side-effects" id="avoiding-global-side-effects" style="color: inherit; text-decoration: none;">
  <h3>Avoiding global side effects</h3>
</a>
<p>Any application that does something useful needs to cause side effects. These might include:</p>
<ul>
<li>Reading or writing some data in a database</li>
<li>Checking the current date and time</li>
<li>Asking the user for input</li>
<li>Logging a message to the console</li>
</ul>
<p>These capabilities are implemented by components of the application, with some components depending on others, and with the implementation or configuration of components often depending on values read from the environment. The quickest way to allow components to communicate with each other is often via globally defined singleton instances. This increases complexity, making code more difficult to debug, test and maintain. Instead, by building components that have their dependencies injected, we can create complex but decoupled applications.</p>
<p>Take the simple example of a timer, that has this type signature:</p>
<pre><code class="language-typescript"><span class="hl-0">type</span><span class="hl-1"> </span><span class="hl-2">HighResTimer</span><span class="hl-1"> = () </span><span class="hl-0">=&gt;</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-2">number</span>
</code></pre>
<p>When we call the timer, it records the current microtime, and returns a function that when called, subtracts it from the microtime at that moment, thereby returning the duration between the 2 function calls. To time this duration, we must read the start and end time from the system clock. When we come to test our code, we have a problem because the function is not deterministic. The side effect being caused is inaccessible from the code of our test, so we&#39;ll have to either use monkey-patching to spoof the current time, or start a separate timer and test that the result is only roughly correct.</p>
<p>Consider this implementation. Firstly, the side effect (a function that gets the current high resolution time) is implemented in isolation:</p>
<pre><code class="language-typescript"><span class="hl-0">type</span><span class="hl-1"> </span><span class="hl-2">GetHighResTime</span><span class="hl-1"> = () </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-2">bigint</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-3">getHighResTime</span><span class="hl-1">: </span><span class="hl-2">GetHighResTime</span><span class="hl-1"> = () </span><span class="hl-0">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">hrtime</span><span class="hl-1">.</span><span class="hl-3">bigint</span><span class="hl-1">()</span>
</code></pre>
<p>The timer function can now be implemented with an injected system clock, and avoids causing a global side effect:</p>
<pre><code class="language-typescript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-3">highResTimer</span><span class="hl-1"> = (</span><span class="hl-4">getHighResTime</span><span class="hl-1">: </span><span class="hl-2">GetHighResTime</span><span class="hl-1">): </span><span class="hl-2">HighResTimer</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">startTime</span><span class="hl-1"> = </span><span class="hl-3">getHighResTime</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-6">return</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-2">Number</span><span class="hl-1">(</span><span class="hl-3">getHighResTime</span><span class="hl-1">() - </span><span class="hl-4">startTime</span><span class="hl-1">)</span><br/><span class="hl-1">}</span>
</code></pre>
<p>This makes our test implementation relatively simple:</p>
<pre><code class="language-typescript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">startTime</span><span class="hl-1"> = </span><span class="hl-2">BigInt</span><span class="hl-1">(</span><span class="hl-2">Math</span><span class="hl-1">.</span><span class="hl-3">pow</span><span class="hl-1">(</span><span class="hl-7">11</span><span class="hl-1">, </span><span class="hl-7">14</span><span class="hl-1">)) </span><span class="hl-8">// Some number roughly as large as the current microtime</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">duration</span><span class="hl-1"> = </span><span class="hl-7">1234</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">endTime</span><span class="hl-1"> = </span><span class="hl-4">startTime</span><span class="hl-1"> + </span><span class="hl-2">BigInt</span><span class="hl-1">(</span><span class="hl-4">duration</span><span class="hl-1">)</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">getHighResTime</span><span class="hl-1"> = </span><span class="hl-4">jest</span><span class="hl-1">.</span><span class="hl-3">fn</span><span class="hl-1">() </span><span class="hl-8">// Create a mock timer that will supply the start and end time</span><br/><span class="hl-1">  .</span><span class="hl-3">mockReturnValueOnce</span><span class="hl-1">(</span><span class="hl-4">startTime</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-3">mockReturnValueOnce</span><span class="hl-1">(</span><span class="hl-4">endTime</span><span class="hl-1">)</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">startTimer</span><span class="hl-1"> = </span><span class="hl-3">highResTimer</span><span class="hl-1">(</span><span class="hl-4">getHighResTime</span><span class="hl-1">)</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">getDuration</span><span class="hl-1"> = </span><span class="hl-3">startTimer</span><span class="hl-1">() </span><span class="hl-8">// The timer is started at `startTime`</span><br/><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-3">getDuration</span><span class="hl-1">()).</span><span class="hl-3">toEqual</span><span class="hl-1">(</span><span class="hl-4">duration</span><span class="hl-1">) </span><span class="hl-8">// `getDuration` returns the correct duration based on the `endTime`</span>
</code></pre>
<p>To define this component as a container module, we create globally unique keys (in <code>keys.ts</code>) that represent the services provided by the module:</p>
<pre><code class="language-typescript"><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">getHighResTime</span><span class="hl-1"> = </span><span class="hl-2">Symbol</span><span class="hl-1">(</span><span class="hl-9">&#39;getHighResTime&#39;</span><span class="hl-1">)</span><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">highResTimer</span><span class="hl-1"> = </span><span class="hl-2">Symbol</span><span class="hl-1">(</span><span class="hl-9">&#39;highResTimer&#39;</span><span class="hl-1">)</span>
</code></pre>
<p>And we create a <a href="modules.html#ServiceMap">ServiceMap</a> for the module, mapping the keys to the service types they represent:</p>
<pre><code class="language-typescript"><span class="hl-6">import</span><span class="hl-1"> </span><span class="hl-0">*</span><span class="hl-1"> </span><span class="hl-6">as</span><span class="hl-1"> </span><span class="hl-4">keys</span><span class="hl-1"> </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-9">&#39;./keys&#39;</span><br/><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-0">type</span><span class="hl-1"> </span><span class="hl-2">ServiceMap</span><span class="hl-1"> = {</span><br/><span class="hl-1">  [</span><span class="hl-4">keys</span><span class="hl-1">.</span><span class="hl-4">getHighResTime</span><span class="hl-1">]: </span><span class="hl-2">GetHighResTime</span><br/><span class="hl-1">  [</span><span class="hl-4">keys</span><span class="hl-1">.</span><span class="hl-4">highResTimer</span><span class="hl-1">]: </span><span class="hl-2">HighResTimer</span><br/><span class="hl-1">}</span>
</code></pre>
<p>We can now declare a resusable <a href="modules.html#ContainerModule">ContainerModule</a>:</p>
<pre><code class="language-typescript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-3">containerModule</span><span class="hl-1">: </span><span class="hl-2">ContainerModule</span><span class="hl-1">&lt;</span><span class="hl-2">ServiceMap</span><span class="hl-1">&gt; = </span><span class="hl-4">builder</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">builder</span><br/><span class="hl-1">  .</span><span class="hl-3">define</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">keys</span><span class="hl-1">.</span><span class="hl-4">getHighResTime</span><span class="hl-1">,</span><br/><span class="hl-1">    () </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">utils</span><span class="hl-1">.</span><span class="hl-4">getHighResTime</span><br/><span class="hl-1">  )</span><br/><span class="hl-1">  .</span><span class="hl-3">define</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">keys</span><span class="hl-1">.</span><span class="hl-4">highResTimer</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">container</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">utils</span><span class="hl-1">.</span><span class="hl-3">highResTimer</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">container</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-4">keys</span><span class="hl-1">.</span><span class="hl-4">getHighResTime</span><span class="hl-1">)</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  )</span>
</code></pre>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-class"><a href="classes/ServiceNotFoundError.html" class="tsd-kind-icon">Service<wbr/>Not<wbr/>Found<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/TSInjectError.html" class="tsd-kind-icon">TSInject<wbr/>Error</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/IContainer.html" class="tsd-kind-icon">IContainer</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/IContainerBuilder.html" class="tsd-kind-icon">IContainer<wbr/>Builder</a></li><li class="tsd-kind-type-alias"><a href="modules.html#ContainerKey" class="tsd-kind-icon">Container<wbr/>Key</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#ContainerModule" class="tsd-kind-icon">Container<wbr/>Module</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#Decorator" class="tsd-kind-icon">Decorator</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#Factory" class="tsd-kind-icon">Factory</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#FactoryMap" class="tsd-kind-icon">Factory<wbr/>Map</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#ServiceMap" class="tsd-kind-icon">Service<wbr/>Map</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#containerKeys" class="tsd-kind-icon">container<wbr/>Keys</a></li><li class="tsd-kind-function"><a href="modules.html#newContainerBuilder" class="tsd-kind-icon">new<wbr/>Container<wbr/>Builder</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>